<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GEON &mdash; Geospatial Experience-Oriented Notation</title>
  <link rel="stylesheet" type='text/css'
    href="https://cdn.jsdelivr.net/gh/devicons/devicon@latest/devicon.min.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/@phosphor-icons/web@2.1.1"></script>
  <style>
    /* ── Theme variables (shared) ───────────────────────── */
    :root {
      --map-filter: invert(100%) hue-rotate(180deg) brightness(95%) contrast(90%);
      --bg: #0f1117;
      --surface: #1a1d27;
      --surface2: #242836;
      --border: #2e3344;
      --text: #e1e4ed;
      --text-dim: #8b8fa3;
      --accent: #6c8cff;
      --accent-dim: #4a6ae0;
      --green: #4ade80;
      --orange: #fb923c;
      --red: #f87171;
      --purple: #c084fc;
      --shadow: rgba(0, 0, 0, 0.4);
      --font-mono: 'SF Mono', 'Cascadia Code', 'Fira Code', 'Consolas', monospace;
      --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      --syn-key: #6c8cff;
      --syn-value: #e1e4ed;
      --syn-list: #4ade80;
      --syn-coord: #fb923c;
      --syn-comment: #8b8fa3;
      --syn-section: #c084fc;
    }

    :root.light {
      --map-filter: none;
      --bg: #f5f6f8;
      --surface: #ffffff;
      --surface2: #ebedf2;
      --border: #d1d5e0;
      --text: #1a1d27;
      --text-dim: #5c6070;
      --accent: #4a6ae0;
      --accent-dim: #3a58c4;
      --green: #16a34a;
      --orange: #d97706;
      --red: #dc2626;
      --purple: #7c3aed;
      --shadow: rgba(0, 0, 0, 0.1);
      --syn-key: #2f54c9;
      --syn-value: #1a1d27;
      --syn-list: #16713a;
      --syn-coord: #b45309;
      --syn-comment: #6b7085;
      --syn-section: #7c3aed;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-sans);
      background: var(--bg);
      color: var(--text);
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      transition: background 0.25s, color 0.25s;
    }

    /* ── Header ──────────────────────────────────────────── */
    header {
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      padding: 10px 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      flex-shrink: 0;
    }

    header .logo {
      height: 44px;
      width: auto;
      object-fit: contain;
      border-radius: 8px;
      box-shadow: 0 6px 18px var(--shadow);
    }

    header h1 {
      font-size: 18px;
      font-weight: 600;
      letter-spacing: -0.02em;
    }

    header h1 span {
      color: var(--accent);
    }

    header .subtitle {
      color: var(--text-dim);
      font-size: 13px;
      flex: 1;
    }

    .nav-links {
      display: flex;
      gap: 4px;
    }

    .nav-link {
      background: var(--surface2);
      border: 1px solid var(--border);
      color: var(--text-dim);
      padding: 6px 14px;
      border-radius: 6px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.15s;
      text-decoration: none;
      font-family: var(--font-sans);
    }

    .nav-link:hover {
      color: var(--text);
      border-color: var(--accent);
    }

    .nav-link.active {
      color: var(--accent);
      border-color: var(--accent);
      background: var(--bg);
    }

    .theme-toggle {
      background: var(--surface2);
      border: 1px solid var(--border);
      color: var(--text-dim);
      width: 34px;
      height: 34px;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s;
      line-height: 1;
    }

    .theme-toggle:hover {
      color: var(--text);
      border-color: var(--accent);
    }

    /* ── Scrollable content ──────────────────────────────── */
    .scroll-wrap {
      flex: 1;
      overflow-y: auto;
      scroll-behavior: smooth;
    }

    .scroll-wrap::-webkit-scrollbar {
      width: 8px;
    }

    .scroll-wrap::-webkit-scrollbar-track {
      background: transparent;
    }

    .scroll-wrap::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 4px;
    }

    .scroll-wrap::-webkit-scrollbar-thumb:hover {
      background: var(--text-dim);
    }

    .content {
      max-width: 1080px;
      margin: 0 auto;
      padding: 0 24px;
    }

    /* ── Hero ─────────────────────────────────────────────── */
    .hero {
      text-align: center;
      padding: 60px 20px 48px;
    }

    .hero-logo {
      width: 120px;
      height: 120px;
      border-radius: 24px;
      box-shadow: 0 12px 40px var(--shadow);
      margin-bottom: 28px;
    }

    .hero h2 {
      font-size: 36px;
      font-weight: 700;
      letter-spacing: -0.03em;
      line-height: 1.15;
      margin-bottom: 12px;
    }

    .hero h2 .highlight {
      color: var(--accent);
    }

    .hero .tagline {
      font-size: 18px;
      color: var(--text-dim);
      max-width: 600px;
      margin: 0 auto 32px;
      line-height: 1.6;
    }

    .hero-actions {
      display: flex;
      gap: 12px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.15s;
      text-decoration: none;
      border: none;
      font-family: var(--font-sans);
    }

    .btn-primary {
      background: var(--accent);
      color: #fff;
    }

    .btn-primary:hover {
      background: var(--accent-dim);
    }

    .btn-secondary {
      background: var(--surface2);
      border: 1px solid var(--border);
      color: var(--text);
    }

    .btn-secondary:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .btn .icon {
      font-size: 18px;
    }

    /* ── Section layout ──────────────────────────────────── */
    .section {
      padding: 48px 0;
    }

    .section+.section {
      border-top: 1px solid var(--border);
    }

    .section-label {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--accent);
      margin-bottom: 8px;
    }

    .section h3 {
      font-size: 24px;
      font-weight: 700;
      letter-spacing: -0.02em;
      margin-bottom: 12px;
    }

    .section .desc {
      font-size: 15px;
      color: var(--text-dim);
      line-height: 1.7;
      max-width: 640px;
      margin-bottom: 28px;
    }

    /* ── Pipeline demo ─────────────────────────────────── */
    .place-chips {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .place-chip {
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s;
      background: var(--surface);
      border: 1px solid var(--border);
      color: var(--text-dim);
      font-family: var(--font-sans);
    }

    .place-chip:hover {
      border-color: var(--accent);
      color: var(--text);
    }

    .place-chip.active {
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
    }

    .pipeline-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: auto auto;
      gap: 12px;
    }

    @media (max-width: 768px) {
      .pipeline-grid {
        grid-template-columns: 1fr;
      }

      .hero h2 {
        font-size: 28px;
      }
    }

    .pipeline-panel {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      transition: border-color 0.3s, box-shadow 0.3s;
    }

    @keyframes panelFlash {
      0% {
        border-color: var(--accent);
        box-shadow: 0 0 16px rgba(108, 140, 255, 0.25);
      }

      100% {
        border-color: var(--border);
        box-shadow: none;
      }
    }

    .pipeline-panel.flash {
      animation: panelFlash 0.8s ease-out;
    }

    .pipeline-panel-header {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 14px;
      background: var(--surface2);
      border-bottom: 1px solid var(--border);
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .pipeline-panel-header .dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      display: inline-block;
    }

    .pipeline-panel-header .panel-label {
      flex: 1;
    }

    .pipeline-panel-header .token-badge {
      font-weight: 500;
      font-size: 10px;
      padding: 2px 8px;
      border-radius: 4px;
    }

    .pipeline-panel pre {
      font-family: var(--font-mono);
      font-size: 11.5px;
      line-height: 1.55;
      padding: 12px;
      margin: 0;
      overflow: auto;
      flex: 1;
      max-height: 320px;
    }

    /* ── Map in pipeline ────────────────────────────────── */
    #demoMap {
      height: 320px;
      width: 100%;
    }

    .leaflet-container {
      background: var(--surface2);
      font-family: var(--font-sans);
    }

    .leaflet-tile-pane {
      filter: var(--map-filter);
    }

    .leaflet-popup-content-wrapper {
      background: var(--surface) !important;
      color: var(--text) !important;
      border-radius: 8px !important;
      border: 1px solid var(--border) !important;
      box-shadow: 0 8px 24px var(--shadow) !important;
    }

    .leaflet-popup-tip {
      background: var(--surface) !important;
    }

    .leaflet-popup-content {
      font-size: 13px !important;
      line-height: 1.5 !important;
      margin: 10px 14px !important;
    }

    .leaflet-popup-content b {
      color: var(--accent);
    }

    /* ── LLM panel ──────────────────────────────────────── */
    .llm-content {
      padding: 12px;
      flex: 1;
      overflow: auto;
      max-height: 320px;
      font-size: 13px;
      line-height: 1.65;
    }

    .llm-prompt {
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 10px 12px;
      margin-bottom: 12px;
      font-size: 12px;
      color: var(--text-dim);
    }

    .llm-prompt strong {
      color: var(--accent);
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      display: block;
      margin-bottom: 4px;
    }

    .llm-response {
      font-size: 13px;
      line-height: 1.7;
      color: var(--text);
    }

    .llm-response .geon-ref {
      color: var(--accent);
      font-weight: 600;
      font-size: 12px;
    }

    .llm-grounding {
      margin-top: 14px;
      padding-top: 10px;
      border-top: 1px solid var(--border);
      font-size: 11px;
      color: var(--text-dim);
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }

    .llm-grounding .ground-ok {
      color: var(--green);
      font-weight: 600;
    }

    .llm-grounding .ground-fields {
      color: var(--accent);
    }

    /* ── Code panel (kept for other sections) ────────────── */
    .code-panel {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .code-panel-header {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      background: var(--surface2);
      border-bottom: 1px solid var(--border);
      font-size: 12px;
      font-weight: 600;
    }

    .code-panel-header .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      display: inline-block;
    }

    .code-panel-header .format-label {
      flex: 1;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .code-panel-header .token-badge {
      font-weight: 500;
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 4px;
    }

    .code-panel pre {
      font-family: var(--font-mono);
      font-size: 12.5px;
      line-height: 1.65;
      padding: 16px;
      margin: 0;
      overflow-x: auto;
      flex: 1;
    }

    /* ── Comparison table ────────────────────────────────── */
    .compare-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
      margin-top: 4px;
    }

    .compare-table th {
      text-align: left;
      padding: 12px 16px;
      font-weight: 600;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-dim);
      border-bottom: 2px solid var(--border);
    }

    .compare-table td {
      padding: 12px 16px;
      border-bottom: 1px solid var(--border);
      vertical-align: top;
    }

    .compare-table tr:last-child td {
      border-bottom: none;
    }

    .compare-table .dim {
      color: var(--text-dim);
    }

    .compare-table .good {
      color: var(--green);
      font-weight: 600;
    }

    .compare-table .meh {
      color: var(--orange);
    }

    .compare-table .bad {
      color: var(--red);
    }

    /* ── Feature cards ───────────────────────────────────── */
    .feature-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 14px;
      margin-top: 4px;
    }

    .feature-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 20px;
      transition: border-color 0.2s;
    }

    .feature-card:hover {
      border-color: var(--accent);
    }

    .feature-card .card-icon {
      font-size: 26px;
      margin-bottom: 12px;
      display: block;
      color: var(--accent);
    }

    .feature-card h4 {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .feature-card p {
      font-size: 13px;
      color: var(--text-dim);
      line-height: 1.6;
    }

    /* ── Stats row ───────────────────────────────────────── */
    .stats-row {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      margin-bottom: 32px;
    }

    .stat-card {
      flex: 1;
      min-width: 140px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 18px 20px;
      text-align: center;
    }

    .stat-card .stat-value {
      font-size: 28px;
      font-weight: 700;
      letter-spacing: -0.02em;
      color: var(--accent);
      line-height: 1.2;
    }

    .stat-card .stat-label {
      font-size: 12px;
      color: var(--text-dim);
      margin-top: 4px;
    }

    /* ── Install block ───────────────────────────────────── */
    .install-block {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      overflow: hidden;
    }

    .install-block pre {
      font-family: var(--font-mono);
      font-size: 13px;
      line-height: 1.7;
      padding: 20px;
      margin: 0;
      overflow-x: auto;
    }

    .install-block .comment {
      color: var(--syn-comment);
    }

    .install-block .cmd {
      color: var(--green);
    }

    /* ── Tool cards ──────────────────────────────────────── */
    .tool-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }

    @media (max-width: 640px) {
      .tool-grid {
        grid-template-columns: 1fr;
      }
    }

    .tool-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 24px;
      text-decoration: none;
      color: var(--text);
      transition: all 0.2s;
      display: block;
    }

    .tool-card:hover {
      border-color: var(--accent);
      transform: translateY(-2px);
      box-shadow: 0 8px 24px var(--shadow);
    }

    .tool-card .tool-icon {
      font-size: 30px;
      margin-bottom: 12px;
      display: block;
      color: var(--accent);
    }

    .tool-card h4 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .tool-card p {
      font-size: 13px;
      color: var(--text-dim);
      line-height: 1.6;
    }

    /* ── Field reference ─────────────────────────────────── */
    .field-columns {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    @media (max-width: 640px) {
      .field-columns {
        grid-template-columns: 1fr;
      }
    }

    .field-col h4 {
      font-size: 13px;
      font-weight: 600;
      color: var(--accent);
      text-transform: uppercase;
      letter-spacing: 0.04em;
      margin-bottom: 10px;
      padding-bottom: 6px;
      border-bottom: 1px solid var(--border);
    }

    .field-col ul {
      list-style: none;
      font-size: 13px;
      line-height: 2;
    }

    .field-col li code {
      font-family: var(--font-mono);
      font-size: 12px;
      color: var(--syn-key);
      background: var(--surface2);
      padding: 1px 6px;
      border-radius: 3px;
    }

    .field-col li .req {
      font-size: 10px;
      color: var(--red);
      font-weight: 600;
      text-transform: uppercase;
      margin-left: 4px;
    }

    .field-col li .opt {
      font-size: 10px;
      color: var(--text-dim);
      margin-left: 4px;
    }

    /* ── Footer ──────────────────────────────────────────── */
    .page-footer {
      padding: 32px 0 48px;
      border-top: 1px solid var(--border);
      text-align: center;
      color: var(--text-dim);
      font-size: 13px;
      line-height: 1.7;
    }

    .page-footer strong {
      color: var(--text);
    }

    .page-footer a {
      color: var(--accent);
      text-decoration: none;
    }

    .page-footer a:hover {
      text-decoration: underline;
    }

    /* ── Status bar ──────────────────────────────────────── */
    .status-bar {
      background: var(--surface);
      border-top: 1px solid var(--border);
      padding: 6px 16px;
      font-size: 11px;
      color: var(--text-dim);
      display: flex;
      gap: 16px;
      flex-shrink: 0;
    }

    .status-bar .sep {
      color: var(--border);
    }

    /* ── Syntax classes ──────────────────────────────────── */
    .geon-key {
      color: var(--syn-key);
      font-weight: 600;
    }

    .geon-value {
      color: var(--syn-value);
    }

    .geon-list {
      color: var(--syn-list);
    }

    .geon-coord {
      color: var(--syn-coord);
    }

    .geon-section {
      color: var(--syn-section);
      font-weight: 600;
    }

    /* ── Library Tabs ────────────────────────────────────── */
    .lib-tabs {
      display: flex;
      gap: 2px;
      margin-bottom: -1px;
      position: relative;
      z-index: 1;
    }

    .lib-tab {
      background: var(--surface);
      border: 1px solid var(--border);
      border-bottom: none;
      padding: 10px 20px;
      border-radius: 8px 8px 0 0;
      color: var(--text-dim);
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      font-family: var(--font-sans);
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.1s;
    }

    .lib-tab:hover {
      color: var(--text);
      background: var(--surface2);
    }

    .lib-tab.active {
      background: var(--surface);
      color: var(--accent);
      border-top: 2px solid var(--accent);
      padding-top: 8px;
      /* Compensate for border */
      border-bottom: 1px solid var(--surface);
    }

    .lib-tab i {
      font-size: 16px;
    }

    .lib-content {
      display: none;
    }

    .lib-content.active {
      display: block;
    }

    .lib-pane {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 0 10px 10px 10px;
      overflow: hidden;
    }

    .lib-pane pre {
      font-family: var(--font-mono);
      font-size: 13px;
      line-height: 1.7;
      padding: 24px;
      margin: 0;
      overflow-x: auto;
    }
  </style>
</head>

<body>

  <header>
    <img class="logo" src="logo.png" alt="GEON logo">
    <h1><span>GEON</span></h1>
    <span class="subtitle">Geospatial Experience-Oriented Notation</span>
    <nav class="nav-links">
      <a class="nav-link active" href="index.html">About</a>
      <a class="nav-link" href="explore.html">Map</a>
      <a class="nav-link" href="form.html">Build</a>
    </nav>
    <button class="theme-toggle" id="themeBtn" onclick="toggleTheme()"
      title="Toggle light/dark theme">&#9790;</button>
  </header>

  <div class="scroll-wrap">
    <div class="content">

      <!-- ── Hero ────────────────────────────────────────── -->
      <div class="hero">
        <img class="hero-logo" src="logo.png" alt="GEON"
          onerror="this.style.display='none'">
        <h2>A <span class="highlight">human &amp; LLM-readable</span> format<br>for spatial
          intelligence</h2>
        <p class="tagline">GEON bridges the gap between machine-optimized geospatial data and rich,
          semantic descriptions of place &mdash; making spatial reasoning accessible to both people
          and AI.</p>
        <div class="hero-actions">
          <a class="btn btn-primary" href="explore.html"><i class="ph ph-globe-hemisphere-west icon"></i> Explore
            Map</a>
          <a class="btn btn-secondary" href="form.html"><i class="ph ph-buildings icon"></i> Build a
            Place</a>
          <a class="btn btn-secondary" href="../spec.md"><i class="ph ph-file-text icon"></i> Read
            the Spec</a>
        </div>
      </div>

      <!-- ── Token stats ─────────────────────────────────── -->
      <div class="section">
        <div class="stats-row">
          <div class="stat-card">
            <div class="stat-value">~24%</div>
            <div class="stat-label">fewer tokens than GeoJSON</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">8.8</div>
            <div class="stat-label">facts per 100 tokens</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">1.2x</div>
            <div class="stat-label">more places per context window</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">10+</div>
            <div class="stat-label">semantic field categories</div>
          </div>
        </div>
      </div>

      <!-- ── Interactive Pipeline Demo ─────────────────────── -->
      <div class="section" id="pipelineSection">
        <div class="section-label">Interactive Pipeline</div>
        <h3>See the full flow</h3>
        <p class="desc">Click a place and watch data flow through the pipeline &mdash; from a point
          on the map to structured GEON, equivalent GeoJSON, and a grounded LLM response.</p>

        <div class="place-chips" id="placeChips">
          <button class="place-chip active" onclick="selectPlace(0)">Market Square</button>
          <button class="place-chip" onclick="selectPlace(1)">Nottingham Castle</button>
          <button class="place-chip" onclick="selectPlace(2)">Sherwood Forest</button>
        </div>

        <div class="pipeline-grid">
          <!-- Map panel -->
          <div class="pipeline-panel" id="pipeMap">
            <div class="pipeline-panel-header">
              <span class="dot" style="background:var(--accent)"></span>
              <span class="panel-label">Map</span>
              <span style="font-size:10px;color:var(--text-dim)">Click markers to switch</span>
            </div>
            <div id="demoMap"></div>
          </div>

          <!-- GEON panel -->
          <div class="pipeline-panel" id="pipeGeon">
            <div class="pipeline-panel-header">
              <span class="dot" style="background:var(--green)"></span>
              <span class="panel-label">GEON</span>
              <span class="token-badge" id="geonTokenBadge"
                style="background:rgba(74,222,128,0.15);color:var(--green)"></span>
            </div>
            <pre id="geonOutput"></pre>
          </div>

          <!-- GeoJSON panel -->
          <div class="pipeline-panel" id="pipeGeojson">
            <div class="pipeline-panel-header">
              <span class="dot" style="background:var(--orange)"></span>
              <span class="panel-label">GeoJSON</span>
              <span class="token-badge" id="geojsonTokenBadge"
                style="background:rgba(251,146,60,0.15);color:var(--orange)"></span>
            </div>
            <pre id="geojsonOutput" style="color:var(--text-dim);font-size:11px;"></pre>
          </div>

          <!-- LLM panel -->
          <div class="pipeline-panel" id="pipeLlm">
            <div class="pipeline-panel-header">
              <span class="dot" style="background:var(--purple)"></span>
              <span class="panel-label">LLM Response</span>
              <span class="token-badge" id="llmFieldsBadge"
                style="background:rgba(192,132,252,0.15);color:var(--purple)"></span>
            </div>
            <div class="llm-content" id="llmOutput"></div>
          </div>
        </div>
      </div>

      <!-- ── Why GEON ────────────────────────────────────── -->
      <div class="section">
        <div class="section-label">Comparison</div>
        <h3>Why GEON?</h3>
        <p class="desc">Traditional geospatial formats are built for machines. GEON is built for
          understanding.</p>

        <table class="compare-table">
          <thead>
            <tr>
              <th></th>
              <th>GeoJSON</th>
              <th>WKT</th>
              <th>GEON</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Readability</strong></td>
              <td class="dim">Machine-first</td>
              <td class="dim">Machine-first</td>
              <td class="good">Human &amp; LLM-first</td>
            </tr>
            <tr>
              <td><strong>Semantics</strong></td>
              <td class="dim">Flat properties bag</td>
              <td class="bad">None</td>
              <td class="good">Structured fields</td>
            </tr>
            <tr>
              <td><strong>Experience</strong></td>
              <td class="bad">Absent</td>
              <td class="bad">Absent</td>
              <td class="good">Core feature</td>
            </tr>
            <tr>
              <td><strong>Relationships</strong></td>
              <td class="meh">Requires computation</td>
              <td class="bad">Absent</td>
              <td class="good">Explicit</td>
            </tr>
            <tr>
              <td><strong>Temporal</strong></td>
              <td class="dim">Limited</td>
              <td class="bad">None</td>
              <td class="good">Integrated</td>
            </tr>
            <tr>
              <td><strong>Token efficiency</strong></td>
              <td class="meh">~24% more</td>
              <td class="dim">Geometry only</td>
              <td class="good">Baseline</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- ── Features ────────────────────────────────────── -->
      <div class="section">
        <div class="section-label">Format Features</div>
        <h3>What GEON captures</h3>
        <p class="desc">Every aspect of a place &mdash; from its physical form to how it feels to be
          there.</p>

        <div class="feature-grid">
          <div class="feature-card">
            <i class="ph ph-map-pin card-icon"></i>
            <h4>Identity &amp; Geometry</h4>
            <p>Name, type, coordinates, boundary polygons, elevation, area &mdash; the spatial
              foundation.</p>
          </div>
          <div class="feature-card">
            <i class="ph ph-crosshair card-icon"></i>
            <h4>Purpose &amp; Function</h4>
            <p>What a place is <em>for</em>: commerce, gathering, worship, recreation &mdash;
              structured by category.</p>
          </div>
          <div class="feature-card">
            <i class="ph ph-sparkle card-icon"></i>
            <h4>Experiential Qualities</h4>
            <p>Openness, noise, safety, pace, enclosure &mdash; 13 scales that describe how a place
              <em>feels</em>.
            </p>
          </div>
          <div class="feature-card">
            <i class="ph ph-graph card-icon"></i>
            <h4>Spatial Relationships</h4>
            <p>Adjacencies, connectivity, containment, viewsheds &mdash; how places relate to each
              other.</p>
          </div>
          <div class="feature-card">
            <i class="ph ph-clock card-icon"></i>
            <h4>Temporal Patterns</h4>
            <p>Footfall rhythms, opening hours, seasonal events, lifespan &mdash; places change over
              time.</p>
          </div>
          <div class="feature-card">
            <i class="ph ph-shield-check card-icon"></i>
            <h4>Provenance &amp; Trust</h4>
            <p>Source attribution, confidence levels, update timestamps &mdash; know where your data
              came from.</p>
          </div>
        </div>
      </div>

      <!-- ── Field Reference ─────────────────────────────── -->
      <div class="section">
        <div class="section-label">Reference</div>
        <h3>Field overview</h3>
        <p class="desc">Three required fields, plus a rich set of optional semantic, relational,
          temporal, and provenance fields.</p>

        <div class="field-columns">
          <div class="field-col">
            <h4>Core Fields</h4>
            <ul>
              <li><code>PLACE</code> <span class="req">required</span> &mdash; name</li>
              <li><code>TYPE</code> <span class="req">required</span> &mdash; classification</li>
              <li><code>LOCATION</code> <span class="req">required</span> &mdash; lat, lon</li>
              <li><code>BOUNDARY</code> <span class="opt">optional</span> &mdash; polygon</li>
              <li><code>EXTENT</code> <span class="opt">optional</span> &mdash; bounding box</li>
              <li><code>AREA</code> <span class="opt">optional</span> &mdash; surface area</li>
              <li><code>ELEVATION</code> <span class="opt">optional</span> &mdash; height</li>
              <li><code>ID</code> <span class="opt">optional</span> &mdash; identifier</li>
            </ul>
            <h4 style="margin-top:16px">Semantic Fields</h4>
            <ul>
              <li><code>PURPOSE</code> &mdash; activity types</li>
              <li><code>EXPERIENCE</code> &mdash; 13 quality scales</li>
              <li><code>CHARACTER</code> &mdash; descriptive traits</li>
            </ul>
          </div>
          <div class="field-col">
            <h4>Relational Fields</h4>
            <ul>
              <li><code>ADJACENCIES</code> &mdash; neighbours</li>
              <li><code>CONNECTIVITY</code> &mdash; networks</li>
              <li><code>CONTAINS</code> &mdash; nested places</li>
              <li><code>PART_OF</code> &mdash; parent place</li>
              <li><code>VIEWSHEDS</code> &mdash; visible landmarks</li>
            </ul>
            <h4 style="margin-top:16px">Temporal &amp; Provenance</h4>
            <ul>
              <li><code>TEMPORAL</code> &mdash; time-varying patterns</li>
              <li><code>LIFESPAN</code> &mdash; age and permanence</li>
              <li><code>SOURCE</code> &mdash; data origins</li>
              <li><code>CONFIDENCE</code> &mdash; quality indicators</li>
              <li><code>UPDATED</code> &mdash; last modified</li>
            </ul>
            <h4 style="margin-top:16px">Extended Domain</h4>
            <ul>
              <li><code>BUILT_FORM</code> <code>ECOLOGY</code> <code>INFRASTRUCTURE</code></li>
              <li><code>DEMOGRAPHICS</code> <code>ECONOMY</code> <code>VISUAL</code></li>
            </ul>
          </div>
        </div>
      </div>

      <!-- ── Tools ───────────────────────────────────────── -->
      <div class="section">
        <div class="section-label">Interactive Tools</div>
        <h3>Try it now</h3>
        <p class="desc">Explore GEON with two browser-based tools &mdash; no install required.</p>

        <div class="tool-grid">
          <a class="tool-card" href="explore.html">
            <i class="ph ph-globe-hemisphere-west tool-icon"></i>
            <h4>Map Explorer</h4>
            <p>Click the map to fetch OSM features, search by name, or paste GeoJSON. See instant
              GEON output with syntax highlighting, validation, and token comparison.</p>
          </a>
          <a class="tool-card" href="form.html">
            <i class="ph ph-buildings tool-icon"></i>
            <h4>Place Builder</h4>
            <p>Fill out every GEON field with a structured form. Purpose chips, experience
              dropdowns, dynamic key-value editors &mdash; live GEON output as you type.</p>
          </a>
        </div>
      </div>

      <!-- ── Libraries ───────────────────────────────────── -->
      <div class="section">
        <div class="section-label">Official Libraries &amp; SDKs</div>
        <h3>Build with GEON</h3>
        <p class="desc">Native parsers, generators, and validators for your favorite languages.</p>

        <div class="lib-tabs">
          <button class="lib-tab active" onclick="switchLibTab('py')">
            <i class="devicon-python-plain"></i> Python
          </button>
          <button class="lib-tab" onclick="switchLibTab('rs')">
            <i class="devicon-rust-plain"></i> Rust
          </button>
          <button class="lib-tab" onclick="switchLibTab('js')">
            <i class="devicon-typescript-plain"></i> TypeScript / JS
          </button>
        </div>

        <div class="lib-pane">
          <!-- Python -->
          <div id="lib-py" class="lib-content active">
            <pre><span class="comment"># Install from GitHub</span>
<span class="cmd">pip install "git+https://github.com/jwilliamsresearch/GEON.git#subdirectory=geon-py"</span>

<span class="comment"># Usage</span>
<span class="cmd">import</span> geon

place = geon.parse(<span class="geon-value">"""
PLACE: Victoria Park
TYPE: public_space
LOCATION: 52.9403, -1.1340
PURPOSE:
  - recreation
  - ecology
"""</span>)

<span class="cmd">print</span>(place.place)      <span class="comment"># "Victoria Park"</span>
<span class="cmd">print</span>(place.location)   <span class="comment"># (52.9403, -1.1340)</span></pre>
          </div>

          <!-- Rust -->
          <div id="lib-rs" class="lib-content">
            <pre><span class="comment"># Add git dependency</span>
<span class="cmd">cargo add --git https://github.com/jwilliamsresearch/GEON.git geon-rs</span>

<span class="comment"># Usage</span>
<span class="cmd">use</span> geon_rs::Geon;

<span class="cmd">let</span> input = <span class="geon-value">r#"
PLACE: Victoria Park
TYPE: public_space
LOCATION: 52.9403, -1.1340
"#</span>;

<span class="cmd">let</span> place: Geon = input.parse()?;
<span class="cmd">println!</span>(<span class="geon-value">"Loaded: {}"</span>, place.identity.name);</pre>
          </div>

          <!-- JS -->
          <div id="lib-js" class="lib-content">
            <pre><span class="comment"># Install from GitHub (as workspace or submodule)</span>
<span class="cmd">npm install github:jwilliamsresearch/GEON</span>

<span class="comment"># Usage</span>
<span class="cmd">import</span> { parse } <span class="cmd">from</span> <span class="geon-value">'geon-js'</span>;

<span class="cmd">const</span> input = <span class="geon-value">`
PLACE: Victoria Park
TYPE: public_space
LOCATION: 52.9403, -1.1340
`</span>;

<span class="cmd">const</span> place = parse(input);
<span class="cmd">console</span>.log(place.identity.name);</pre>
          </div>
        </div>
      </div>

      <!-- ── Footer ──────────────────────────────────────── -->
      <div class="page-footer">
        <p><strong>GEON</strong> &mdash; Geospatial Experience-Oriented Notation &mdash; v0.1.0</p>
        <p>Developed by <strong>James Williams</strong> at the <strong>University of
            Nottingham</strong></p>
        <p>Specification licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY
            4.0</a></p>
      </div>

    </div>
  </div>

  <div class="status-bar">
    <span>GEON v0.1.0</span>
    <span class="sep">|</span>
    <span>James Williams &mdash; University of Nottingham</span>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // ── Theme ────────────────────────────────────────────────────────────────

    let currentTheme = localStorage.getItem('geon-theme') || 'dark';

    function applyTheme(theme) {
      currentTheme = theme;
      document.documentElement.classList.toggle('light', theme === 'light');
      document.getElementById('themeBtn').innerHTML = theme === 'dark' ? '&#9790;' : '&#9788;';
      localStorage.setItem('geon-theme', theme);
    }

    function toggleTheme() {
      applyTheme(currentTheme === 'dark' ? 'light' : 'dark');
    }

    applyTheme(currentTheme);

    function switchLibTab(lang) {
      document.querySelectorAll('.lib-tab').forEach(t => t.classList.remove('active'));
      event.currentTarget.classList.add('active');
      document.querySelectorAll('.lib-content').forEach(c => c.classList.remove('active'));
      document.getElementById('lib-' + lang).classList.add('active');
    }

    // ── Place data ────────────────────────────────────────────────────────────

    const PLACES = [
      {
        name: 'Nottingham Market Square',
        lat: 52.9548, lon: -1.1581,
        geon: `PLACE: Nottingham Market Square
TYPE: public_space
LOCATION: 52.95480, -1.15810
AREA: 22000 sqm
PURPOSE:
  - civic gathering
  - events and festivals
  - informal commerce
  - circulation
EXPERIENCE:
  openness: high
  enclosure: medium
  accessibility: high
  activity_density: variable
CHARACTER:
  - one of the largest public squares in England
  - Georgian and Victorian surrounding architecture
  - civic focal point since medieval era
ADJACENCIES:
  - Old Market Square tram stop (50m north)
  - Council House (immediate west)
  - Exchange Arcade (southeast corner)
CONNECTIVITY:
  pedestrian_entries: 6
  vehicular_access: restricted
  public_transport: tram (adjacent)
TEMPORAL:
  weekday_footfall: 2000-3000 people/hour
  weekend_events: 2-3 per month
  evening_activity: low (20% of daytime)
SOURCE:
  - field survey (2025-01)
  - OpenStreetMap
UPDATED: 2025-01-15`,
        geojson: {
          type: 'Feature',
          geometry: { type: 'Point', coordinates: [-1.1581, 52.9548] },
          properties: {
            name: 'Nottingham Market Square',
            type: 'public_space',
            area: '22000 sqm',
            purpose: ['civic gathering', 'events and festivals', 'informal commerce', 'circulation'],
            experience_openness: 'high',
            experience_enclosure: 'medium',
            experience_accessibility: 'high',
            experience_activity_density: 'variable',
            character: [
              'one of the largest public squares in England',
              'Georgian and Victorian surrounding architecture',
              'civic focal point since medieval era'
            ],
            adjacency_1: 'Old Market Square tram stop (50m north)',
            adjacency_2: 'Council House (immediate west)',
            adjacency_3: 'Exchange Arcade (southeast corner)',
            connectivity_pedestrian_entries: 6,
            connectivity_vehicular_access: 'restricted',
            connectivity_public_transport: 'tram (adjacent)',
            temporal_weekday_footfall: '2000-3000 people/hour',
            temporal_weekend_events: '2-3 per month',
            temporal_evening_activity: 'low (20% of daytime)',
            source: ['field survey (2025-01)', 'OpenStreetMap'],
            updated: '2025-01-15'
          }
        },
        llm: {
          prompt: 'Using this GEON data, describe this place for a first-time visitor.',
          response: 'Nottingham Market Square is one of England\'s largest <span class="geon-ref">public squares</span> (<span class="geon-ref">22,000 sqm</span>), serving as the city\'s civic heart since the medieval era. Expect a <span class="geon-ref">highly open</span> space with <span class="geon-ref">variable activity density</span> -- it hosts <span class="geon-ref">2-3 weekend events</span> monthly with <span class="geon-ref">2,000-3,000 people/hour</span> on weekdays. The surrounding <span class="geon-ref">Georgian and Victorian architecture</span> frames a space used for <span class="geon-ref">civic gathering, events, and informal commerce</span>. The square is easily accessible by <span class="geon-ref">tram (adjacent)</span> with <span class="geon-ref">6 pedestrian entries</span>, though <span class="geon-ref">vehicular access is restricted</span>. Evening activity drops to about <span class="geon-ref">20% of daytime</span> levels.',
          fields: 12,
          hallucinations: 0
        }
      },
      {
        name: 'Nottingham Castle',
        lat: 52.9490, lon: -1.1560,
        geon: `PLACE: Nottingham Castle
TYPE: landmark
LOCATION: 52.94900, -1.15600
ELEVATION: 40m above river level
PURPOSE:
  - tourism (museum and gallery)
  - heritage
  - recreation
EXPERIENCE:
  openness: medium
  enclosure: medium
  accessibility: medium
  safety: high
CHARACTER:
  - 17th-century ducal mansion on medieval castle site
  - panoramic views across Nottingham from Castle Rock
  - Robin Hood heritage and legend connections
ADJACENCIES:
  - Ye Olde Trip to Jerusalem (50m south)
  - Castle Boulevard (immediate south)
  - The Park Estate (west)
CONNECTIVITY:
  pedestrian_access: stepped and ramped
  vehicular_access: limited
  nearest_tram: Nottingham station (400m)
TEMPORAL:
  opening_hours: 10:00-17:00 (Tue-Sun)
  peak_season: summer (June-August)
  events: seasonal exhibitions
SOURCE:
  - Nottingham City Council
  - OpenStreetMap
UPDATED: 2025-01-15`,
        geojson: {
          type: 'Feature',
          geometry: { type: 'Point', coordinates: [-1.1560, 52.9490] },
          properties: {
            name: 'Nottingham Castle',
            type: 'landmark',
            elevation: '40m above river level',
            purpose: ['tourism (museum and gallery)', 'heritage', 'recreation'],
            experience_openness: 'medium',
            experience_enclosure: 'medium',
            experience_accessibility: 'medium',
            experience_safety: 'high',
            character: [
              '17th-century ducal mansion on medieval castle site',
              'panoramic views across Nottingham from Castle Rock',
              'Robin Hood heritage and legend connections'
            ],
            adjacency_1: 'Ye Olde Trip to Jerusalem (50m south)',
            adjacency_2: 'Castle Boulevard (immediate south)',
            connectivity_pedestrian_access: 'stepped and ramped',
            connectivity_vehicular_access: 'limited',
            temporal_opening_hours: '10:00-17:00 (Tue-Sun)',
            temporal_peak_season: 'summer (June-August)',
            source: ['Nottingham City Council', 'OpenStreetMap'],
            updated: '2025-01-15'
          }
        },
        llm: {
          prompt: 'Using this GEON data, describe this place for a first-time visitor.',
          response: 'Nottingham Castle is a <span class="geon-ref">landmark</span> perched on <span class="geon-ref">Castle Rock</span>, <span class="geon-ref">40m above river level</span>, offering <span class="geon-ref">panoramic views across Nottingham</span>. The current <span class="geon-ref">17th-century ducal mansion</span> replaced the medieval fortification and now operates as a <span class="geon-ref">museum and gallery</span>, open <span class="geon-ref">Tue-Sun 10:00-17:00</span>. Expect <span class="geon-ref">medium accessibility</span> due to <span class="geon-ref">stepped and ramped pedestrian access</span> on the elevated site. The castle connects to <span class="geon-ref">Robin Hood heritage</span>, and nearby you\'ll find <span class="geon-ref">Ye Olde Trip to Jerusalem</span> (50m south), one of England\'s oldest pubs. <span class="geon-ref">Summer</span> is peak season for visitors.',
          fields: 11,
          hallucinations: 0
        }
      },
      {
        name: 'Sherwood Forest',
        lat: 53.2036, lon: -1.0689,
        geon: `PLACE: Sherwood Forest
TYPE: natural_feature
LOCATION: 53.20360, -1.06890
AREA: 423 hectares
PURPOSE:
  - ecology
  - recreation
  - heritage
EXPERIENCE:
  openness: high
  noise: low
  safety: high
  naturalness: very_high
CHARACTER:
  - ancient oak woodland, remnant of royal hunting forest
  - home to the Major Oak (800+ years old)
  - Robin Hood legend origins
ADJACENCIES:
  - Edwinstowe village (immediate east)
  - Sherwood Forest visitor centre (within)
  - Clumber Park (8km north)
CONNECTIVITY:
  pedestrian_trails: extensive network
  vehicular_access: car park at visitor centre
  nearest_rail: Mansfield (10km)
TEMPORAL:
  peak_season: summer (June-August)
  autumn_interest: high (leaf colour)
  dawn_chorus: April-June
SOURCE:
  - Natural England
  - OpenStreetMap
UPDATED: 2025-01-15`,
        geojson: {
          type: 'Feature',
          geometry: { type: 'Point', coordinates: [-1.0689, 53.2036] },
          properties: {
            name: 'Sherwood Forest',
            type: 'natural_feature',
            area: '423 hectares',
            purpose: ['ecology', 'recreation', 'heritage'],
            experience_openness: 'high',
            experience_noise: 'low',
            experience_safety: 'high',
            experience_naturalness: 'very_high',
            character: [
              'ancient oak woodland, remnant of royal hunting forest',
              'home to the Major Oak (800+ years old)',
              'Robin Hood legend origins'
            ],
            adjacency_1: 'Edwinstowe village (immediate east)',
            adjacency_2: 'Sherwood Forest visitor centre (within)',
            adjacency_3: 'Clumber Park (8km north)',
            connectivity_pedestrian_trails: 'extensive network',
            connectivity_vehicular_access: 'car park at visitor centre',
            temporal_peak_season: 'summer (June-August)',
            temporal_autumn_interest: 'high (leaf colour)',
            source: ['Natural England', 'OpenStreetMap'],
            updated: '2025-01-15'
          }
        },
        llm: {
          prompt: 'Using this GEON data, describe this place for a first-time visitor.',
          response: 'Sherwood Forest is a <span class="geon-ref">natural feature</span> covering <span class="geon-ref">423 hectares</span> of <span class="geon-ref">ancient oak woodland</span> north of Nottingham, famous as the <span class="geon-ref">origin of the Robin Hood legend</span>. The <span class="geon-ref">very high naturalness</span> and <span class="geon-ref">low noise</span> levels create a peaceful retreat with <span class="geon-ref">high safety</span>. The centrepiece is the <span class="geon-ref">Major Oak (800+ years old)</span>, accessible via an <span class="geon-ref">extensive pedestrian trail network</span>. Visit in <span class="geon-ref">summer</span> for the best weather, <span class="geon-ref">April-June for the dawn chorus</span>, or <span class="geon-ref">autumn for spectacular leaf colours</span>. Park at the <span class="geon-ref">visitor centre</span> near <span class="geon-ref">Edwinstowe village</span>.',
          fields: 12,
          hallucinations: 0
        }
      }
    ];

    // ── Helpers ───────────────────────────────────────────────────────────────

    function esc(t) { const d = document.createElement('div'); d.textContent = t; return d.innerHTML; }
    function estimateTokens(text) { return Math.max(1, Math.round(text.length / 4)); }

    function highlightGeon(text) {
      return text.split('\n').map(line => {
        if (line.match(/^\s*-\s+(-?\d+\.?\d*),\s*(-?\d+\.?\d*)/))
          return `<span class="geon-list">  - </span><span class="geon-coord">${esc(line.replace(/^\s*-\s+/, ''))}</span>`;
        if (line.match(/^\s*-\s+/))
          return `<span class="geon-list">${esc(line)}</span>`;
        const m = line.match(/^(\s*)([\w_]+):\s*(.*)$/);
        if (m) {
          const [, indent, key, value] = m;
          const sections = ['PURPOSE', 'EXPERIENCE', 'CHARACTER', 'ADJACENCIES', 'CONNECTIVITY', 'CONTAINS', 'TEMPORAL', 'SOURCE', 'CONFIDENCE', 'BOUNDARY', 'VIEWSHEDS'];
          if (!value && sections.includes(key)) return `${indent}<span class="geon-section">${esc(key)}:</span>`;
          const isCoord = value.match(/^-?\d+\.?\d*,\s*-?\d+\.?\d*$/);
          return `${indent}<span class="geon-key">${esc(key)}:</span> <span class="${isCoord ? 'geon-coord' : 'geon-value'}">${esc(value)}</span>`;
        }
        return esc(line);
      }).join('\n');
    }

    // ── Map setup ─────────────────────────────────────────────────────────────

    const demoMap = L.map('demoMap', { zoomControl: false, attributionControl: false }).setView([52.97, -1.14], 11);
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 18 }).addTo(demoMap);
    L.control.attribution({ prefix: false }).addAttribution('&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a>').addTo(demoMap);

    const markerGroup = L.layerGroup().addTo(demoMap);
    let activeMarkerIdx = 0;

    const defaultIcon = L.circleMarker([0, 0], { radius: 8, color: '#6c8cff', fillColor: '#6c8cff', fillOpacity: 0.5, weight: 2 }).options;
    const activeIcon = L.circleMarker([0, 0], { radius: 10, color: '#fff', fillColor: '#6c8cff', fillOpacity: 1, weight: 3 }).options;

    const markers = PLACES.map((p, i) => {
      const m = L.circleMarker([p.lat, p.lon], i === 0 ? activeIcon : defaultIcon).addTo(markerGroup);
      m.bindTooltip(p.name, { direction: 'top', offset: [0, -10] });
      m.on('click', () => selectPlace(i));
      return m;
    });

    // Fix map rendering after scroll into view
    const mapObserver = new IntersectionObserver((entries) => {
      entries.forEach(e => { if (e.isIntersecting) demoMap.invalidateSize(); });
    }, { threshold: 0.1 });
    mapObserver.observe(document.getElementById('demoMap'));

    // ── Pipeline animation ────────────────────────────────────────────────────

    let currentPlace = 0;

    function selectPlace(idx) {
      currentPlace = idx;
      const place = PLACES[idx];

      // Update chips
      document.querySelectorAll('.place-chip').forEach((c, i) => c.classList.toggle('active', i === idx));

      // Update markers
      markers.forEach((m, i) => {
        m.setStyle(i === idx ? activeIcon : defaultIcon);
        if (i === idx) m.setRadius(10); else m.setRadius(8);
      });

      // Pan map
      demoMap.flyTo([place.lat, place.lon], place.name === 'Sherwood Forest' ? 12 : 15, { duration: 0.8 });

      // Cascade panel updates with flash animation
      const panels = ['pipeMap', 'pipeGeon', 'pipeGeojson', 'pipeLlm'];
      const delays = [0, 150, 300, 450];

      delays.forEach((delay, i) => {
        setTimeout(() => {
          const panel = document.getElementById(panels[i]);
          if (!panel) return;
          panel.classList.remove('flash');
          void panel.offsetWidth;
          panel.classList.add('flash');

          if (i === 1) updateGeonPanel(place);
          if (i === 2) updateGeojsonPanel(place);
          if (i === 3) updateLlmPanel(place);
        }, delay);
      });
    }

    function updateGeonPanel(place) {
      const gt = estimateTokens(place.geon);
      document.getElementById('geonTokenBadge').textContent = `~${gt} tokens`;
      document.getElementById('geonOutput').innerHTML = highlightGeon(place.geon);
    }

    function updateGeojsonPanel(place) {
      const geojsonStr = JSON.stringify(place.geojson, null, 2);
      const jt = estimateTokens(geojsonStr);
      const gt = estimateTokens(place.geon);
      const overhead = ((jt / gt - 1) * 100).toFixed(0);
      document.getElementById('geojsonTokenBadge').textContent = `~${jt} tokens (+${overhead}%)`;
      document.getElementById('geojsonOutput').textContent = geojsonStr;
    }

    function updateLlmPanel(place) {
      const llm = place.llm;
      document.getElementById('llmFieldsBadge').textContent = `${llm.fields} fields used`;
      document.getElementById('llmOutput').innerHTML = `
        <div class="llm-prompt">
          <strong>Prompt</strong>
          ${esc(llm.prompt)}
        </div>
        <div class="llm-response">${llm.response}</div>
        <div class="llm-grounding">
          <span class="ground-ok">0 hallucinations</span>
          <span class="ground-fields">${llm.fields} facts grounded in GEON</span>
          <span>All <span class="geon-ref">highlighted</span> terms from source data</span>
        </div>
      `;
    }

    // ── Initialize ────────────────────────────────────────────────────────────

    // Load first place immediately
    updateGeonPanel(PLACES[0]);
    updateGeojsonPanel(PLACES[0]);
    updateLlmPanel(PLACES[0]);

    // Run initial pipeline animation after a brief delay
    setTimeout(() => selectPlace(0), 500);
  </script>
</body>

</html>
